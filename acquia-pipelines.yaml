version: 1.0.0
ssh-keys:
  - ssh-key-2:
      secure: sdhnwiedjlqwkdjqwdkkpqwjkdkjwldjhowjdlkwdlowjedlwkedjwdijwedwqswss
  - ssh-key-1:
      secure: sdhnwiedjlqwkdjqwdkkpqwjkdkjwldjhowjdlkwdlowjedlwkedjwdijwedwqswss
variables:
  global:
    PASSWORD: test_password
    CUSTOM_VAR: value
events:
  build:
    steps:
      - behaviors:
          type: script
          script:
            - echo 'STARTED'
            - export PIPELINE_SSH_KEY=~/.ssh/ssh-key-1
            # - git ls-remote git@bitbucket.org:username/repo-dependent-on-ssh-key-1.git
            - echo 'Steps (git operations) will be successful which are dependent on ssh-key-1'
            - sleep 50
            - echo $PIPELINE_SSH_KEY
            - unset PIPELINE_SSH_KEY
            - echo 'Step executed with default ssh keys'
            - export PIPELINE_SSH_KEY=~/.ssh/ssh-key-2
            - sleep 50
            # - git ls-remote git@bitbucket.org:username/repo-dependent-on-ssh-key-2.git
            - echo $PIPELINE_SSH_KEY
            - - echo 'Steps (git operations) will be successful which are dependent on ssh-key-2'
            - unset PIPELINE_SSH_KEY
            - echo 'FINISHED'
      - background-check:
          type: script
          script:
            - 'test -d /proc/$(cat /tmp/bg.pid) && echo "Background job is still running."'
      - variable-across-steps-check:
          type: script
          script:
            - 'echo "PERSISTENT_VAR=" : ${PERSISTENT_VAR?"Need to set PERSISTENT_VAR"}'
      - check-ssh-key-access:
          type: script
          script:
            - 'echo "CHECK IF SSH KEYS EXISTS ON BUILD EVENT"'
            - ls -l ~/.ssh
            - sleep 100
